<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        form {
            width: 300px;
            text-align: center;
            margin: auto;
            background-color: turquoise;
        }
        
        button {
            width: 302px;
            background-color: red;
            border: solid 1px;
        }
        
        .zhuti {
            top: 300px;
            width: 302px;
            height: 350px;
            position: relative;
            margin: auto;
            background-color: pink;
            border: 1px solid;
            border-radius: 0 0 15% 15%;
        }
        
        h4 {
            position: absolute;
            width: 301px;
            text-indent: 2em;
            font-weight: 500;
            background-color: pink;
        }
    </style>
</head>

<body>
    <div class="zhuti">

        <form name="frm">
            <div style="font-weight: 600;font-size: large;">
                阿论小六壬算卦
            </div>
            所要占卜月份是
            <select id="yue">
                 <option value="1">1</option>
                 <option value="2">2</option>
                 <option value="3">3</option>
                 <option value="4">4</option>
                 <option value="5" selected="selected">5</option>
                 <option value="6">6</option>
                 <option value="7">7</option>
                 <option value="8">8</option>
                 <option value="9">9</option>
                 <option value="10">10</option>
                 <option value="11">11</option>
                 <option value="12">12</option>       
                 </select>月<br />所要占卜日期是
            <select id="tian">
                     <option value="1">1</option>
                     <option value="2">2</option>
                     <option value="3">3</option>
                     <option value="4">4</option>
                     <option value="5">5</option>
                     <option value="6">6</option>
                     <option value="7">7</option>
                     <option value="8">8</option>
                     <option value="9">9</option>
                     <option value="10">10</option>
                     <option value="11">11</option>
                     <option value="12" selected="selected">12</option>   
                     <option value="13">13</option>  
                     <option value="14">14</option>  
                     <option value="15">15</option>  
                     <option value="16">16</option>  
                     <option value="17">17</option>  
                     <option value="18">18</option>  
                     <option value="19">19</option>  
                     <option value="20">20</option>       
                     <option value="21">21</option>  
                     <option value="22">22</option>  
                     <option value="23">23</option>  
                     <option value="24">24</option>  
                     <option value="25">25</option>  
                     <option value="26">26</option>  
                     <option value="27">27</option>  
                     <option value="28">28</option>  
                     <option value="29">29</option>  
                     <option value="30">30</option> 
                     <option value="31">31</option>
                 </select>日<br />所要占卜时间是
            <select id="shi">        
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                    <option value="7">7</option>
                    <option value="8">8</option>
                    <option value="9">9</option>
                    <option value="10">10</option>
                    <option value="11">11</option>
                    <option value="12">12</option>   
                    <option value="13">13</option>  
                    <option value="14">14</option>  
                    <option value="15">15</option>  
                    <option value="16">16</option>  
                    <option value="17">17</option>  
                    <option value="18" selected="selected">18</option>  
                    <option value="19">19</option>  
                    <option value="20">20</option>       
                    <option value="21">21</option>  
                    <option value="22">22</option>  
                    <option value="23">23</option>  
                    <option value="24">24</option>          
                 </select>时
        </form>
        <button type="button">开始卜卦</button>
        <h4 id="neirong"></h4>
    </div>
    <script>
        // var year1 = prompt('请输入年份');
        // var month1 = prompt('请输入占卜的新历月份');
        // var date1 = prompt('请输入占卜的新历日期');
        // var lHour = prompt("请输入第几个小时，如：“23");
        //  console.log(lHour);
        //console.log(year1, month1, date1);
        var month1 = document.getElementById('yue');
        var date1 = document.getElementById('tian');
        var lHour = document.getElementById('shi');
        var btn = document.querySelector('button');
        btn.addEventListener('click', function() {
            var month1 = frm.yue.value;
            var date1 = frm.tian.value;
            var lHour = frm.shi.value;
            console.log(month1);
            console.log(date1);
            console.log(lHour);


            hour1();
            var lunarInfo = new Array(
                0x4bd8, 0x4ae0, 0xa570, 0x54d5, 0xd260, 0xd950, 0x5554, 0x56af, 0x9ad0, 0x55d2,
                0x4ae0, 0xa5b6, 0xa4d0, 0xd250, 0xd255, 0xb54f, 0xd6a0, 0xada2, 0x95b0, 0x4977,
                0x497f, 0xa4b0, 0xb4b5, 0x6a50, 0x6d40, 0xab54, 0x2b6f, 0x9570, 0x52f2, 0x4970,
                0x6566, 0xd4a0, 0xea50, 0x6a95, 0x5adf, 0x2b60, 0x86e3, 0x92ef, 0xc8d7, 0xc95f,
                0xd4a0, 0xd8a6, 0xb55f, 0x56a0, 0xa5b4, 0x25df, 0x92d0, 0xd2b2, 0xa950, 0xb557,
                0x6ca0, 0xb550, 0x5355, 0x4daf, 0xa5b0, 0x4573, 0x52bf, 0xa9a8, 0xe950, 0x6aa0,
                0xaea6, 0xab50, 0x4b60, 0xaae4, 0xa570, 0x5260, 0xf263, 0xd950, 0x5b57, 0x56a0,
                0x96d0, 0x4dd5, 0x4ad0, 0xa4d0, 0xd4d4, 0xd250, 0xd558, 0xb540, 0xb6a0, 0x95a6,
                0x95bf, 0x49b0, 0xa974, 0xa4b0, 0xb27a, 0x6a50, 0x6d40, 0xaf46, 0xab60, 0x9570,
                0x4af5, 0x4970, 0x64b0, 0x74a3, 0xea50, 0x6b58, 0x5ac0, 0xab60, 0x96d5, 0x92e0,
                0xc960, 0xd954, 0xd4a0, 0xda50, 0x7552, 0x56a0, 0xabb7, 0x25d0, 0x92d0, 0xcab5,
                0xa950, 0xb4a0, 0xbaa4, 0xad50, 0x55d9, 0x4ba0, 0xa5b0, 0x5176, 0x52bf, 0xa930,
                0x7954, 0x6aa0, 0xad50, 0x5b52, 0x4b60, 0xa6e6, 0xa4e0, 0xd260, 0xea65, 0xd530,
                0x5aa0, 0x76a3, 0x96d0, 0x4afb, 0x4ad0, 0xa4d0, 0xd0b6, 0xd25f, 0xd520, 0xdd45,
                0xb5a0, 0x56d0, 0x55b2, 0x49b0, 0xa577, 0xa4b0, 0xaa50, 0xb255, 0x6d2f, 0xada0,
                0x4b63, 0x937f, 0x49f8, 0x4970, 0x64b0, 0x68a6, 0xea5f, 0x6b20, 0xa6c4, 0xaaef,
                0x92e0, 0xd2e3, 0xc960, 0xd557, 0xd4a0, 0xda50, 0x5d55, 0x56a0, 0xa6d0, 0x55d4,
                0x52d0, 0xa9b8, 0xa950, 0xb4a0, 0xb6a6, 0xad50, 0x55a0, 0xaba4, 0xa5b0, 0x52b0,
                0xb273, 0x6930, 0x7337, 0x6aa0, 0xad50, 0x4b55, 0x4b6f, 0xa570, 0x54e4, 0xd260,
                0xe968, 0xd520, 0xdaa0, 0x6aa6, 0x56df, 0x4ae0, 0xa9d4, 0xa4d0, 0xd150, 0xf252,
                0xd520);

            function leapMonth(y) {
                var lm = lunarInfo[y - 1900] & 0xf;
                return (lm == 0xf ? 0 : lm);
            }

            function monthDays(y, m) {
                return ((lunarInfo[y - 1900] & (0x10000 >> m)) ? 30 : 29);
            }

            function leapDays(y) {
                if (leapMonth(y)) return ((lunarInfo[y - 1899] & 0xf) == 0xf ? 30 : 29);
                else return (0);
            }

            //return days of lunar year
            function lYearDays(y) {
                var i, sum = 348;
                for (i = 0x8000; i > 0x8; i >>= 1) sum += (lunarInfo[y - 1900] & i) ? 1 : 0;
                return (sum + leapDays(y));
            }

            function hour1() {
                if (lHour <= 1) {
                    x = 1;
                } else if (lHour % 2 == 0) {
                    x = (lHour / 2) + 1;
                } else {
                    x = lHour / 2 + 1 / 2;
                }
                // alert(x)
            }

            function gua() {
                jieguo = (m + d + x) % 6
                console.log("求余6后：" + (m + d + x) % 6);

                if (jieguo == 1) {
                    document.getElementById("neirong").innerHTML = ('大安，顾名思义，最大的平安，求谋意思是求财，或者办事，谋，谋划的意思，比如业务员做业务找方向，可用。失物去不远，就是丢失的东西没有丢多远，就在附近。生病的人，没有生命危险，或者没有恶化的情况。');

                } else if (jieguo == 2) {
                    document.getElementById("neirong").innerHTML = ('留连，有拖延的意思，办事不利索，很难成功，官事只宜缓，打官司，诉讼不能急于求成，要缓一缓，去者来回成，办事白跑了一趟。丢失的东西在南方，一定要马上寻找，要快，还要防范与人发生口角，但是总的来说人事且平平，就是没有大的问题，很平常的意思。')
                } else if (jieguo == 3) {
                    document.getElementById("neirong").innerHTML = ('速喜，有喜事，求财向南方去，丢东西应该是在申时，未时，午时，而且丢的东西应该没有离开丢失的地方（没有被人拿走），还会有人看到。你要多打听，应该有人告诉你。生病的人也不用害怕，出门的人有音信传回来。');
                } else if (jieguo == 4) {
                    document.getElementById("neirong").innerHTML = ('赤口，就是口舌，与人吵架，会与人发生打官司告状的事情，需要防范。丢失的东西一定要马上寻找。出门在外的人可能遇到惊慌（多指离家出走的人，失踪的人）。就是有惊险，鸡犬等动物出现怪异的现象，生病的人有危险，防范别人的诅咒，还有传染病。')
                } else if (jieguo == 5) {
                    document.getElementById("neirong").innerHTML = ('小吉，小小的吉祥，路上有事好商量，有人来报喜，报喜之人为女人（男为阳，女为阴），失物在南方，出走的人很快就会回来（多指离家出走的人，失踪的人）。凡是都很和美，生病的人要祈福上苍。')
                } else if (jieguo == 6) {
                    document.getElementById("neirong").innerHTML = ('空亡，是最不好的，大凶，有女人作怪，出走的人可能遇到灾祸（多指离家出走的人，失踪的人）。丢的东西找不到了，官司中有人受伤，病人也可能加重。')
                }
            }


            //calcute lunar date  .year .month .day .isLeap
            function Lunar(objDate) {
                var i, leap = 0,
                    temp = 0;
                var offset = (Date.UTC(objDate.getFullYear(), month1 - '1', date1) - Date.UTC(1900, 0, 31)) / 86400000;
                //var offset = (Date.UTC(objDate.getFullYear(), objDate.getMonth(), objDate.getDate()) - Date.UTC(1900, 0, 31)) / 86400000; //1592438400000
                // console.log(objDate.getFullYear(), objDate.getMonth(), objDate.getDate());
                // console.log(year1, month1, date1)
                for (i = 1900; i < 2100 && offset > 0; i++) {
                    temp = lYearDays(i);
                    offset -= temp;
                }
                if (offset < 0) {
                    offset += temp;
                    i--;
                }
                this.year = i;
                leap = leapMonth(i); //闰哪个月
                this.isLeap = false;
                for (i = 1; i < 13 && offset > 0; i++) {
                    //闰月
                    if (leap > 0 && i == (leap + 1) && this.isLeap == false) {
                        --i;
                        this.isLeap = true;
                        temp = leapDays(this.year);
                    } else {
                        temp = monthDays(this.year, i);
                    }
                    //解除闰月
                    if (this.isLeap == true && i == (leap + 1)) this.isLeap = false;
                    offset -= temp;
                }
                if (offset == 0 && leap > 0 && i == leap + 1)
                    if (this.isLeap) {
                        this.isLeap = false;
                    } else {
                        this.isLeap = true;
                        --i;
                    }
                if (offset < 0) {
                    offset += temp;
                    --i;
                }
                this.month = i;
                this.day = offset + 1;
            }

            var lDate = new Lunar(new Date());
            //   console.log(new Lunar(new Date()));
            var y = lDate.year;
            var m = lDate.month;
            var d = lDate.day;
            gua();
            // alert(y + "-" + m + "-" + d);
            console.log(y + "-" + m + "-" + d + "-" + x);
        })
    </script>
</body>

</html>